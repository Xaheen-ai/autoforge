# Xaheen Docker Compose
# ========================
# Single-service deployment for VPS
#
# Usage:
#   cp .env.example .env  # Configure your API keys
#   docker compose up -d
#
# Data is persisted in Docker volumes for projects and the SQLite database.

services:
  xaheen:
    build:
      context: ..
      dockerfile: deploy/Dockerfile
    container_name: xaheen
    restart: unless-stopped
    ports:
      - "${XAHEEN_PORT:-8888}:8888"
    volumes:
      # Persist projects and database across container restarts
      - xaheen-projects:/data/projects
      - xaheen-db:/data/db
      # Mount host projects directory (optional - for accessing existing projects)
      # - /path/to/your/projects:/data/projects
    environment:
      # API Configuration (required - set in .env file)
      - ANTHROPIC_BASE_URL=${ANTHROPIC_BASE_URL:-}
      - ANTHROPIC_AUTH_TOKEN=${ANTHROPIC_AUTH_TOKEN:-}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY:-}
      - ANTHROPIC_DEFAULT_OPUS_MODEL=${ANTHROPIC_DEFAULT_OPUS_MODEL:-}
      - ANTHROPIC_DEFAULT_SONNET_MODEL=${ANTHROPIC_DEFAULT_SONNET_MODEL:-}
      - ANTHROPIC_DEFAULT_HAIKU_MODEL=${ANTHROPIC_DEFAULT_HAIKU_MODEL:-}
      # Vertex AI (optional)
      - CLAUDE_CODE_USE_VERTEX=${CLAUDE_CODE_USE_VERTEX:-}
      - CLOUD_ML_REGION=${CLOUD_ML_REGION:-}
      - ANTHROPIC_VERTEX_PROJECT_ID=${ANTHROPIC_VERTEX_PROJECT_ID:-}
      # GitHub (optional)
      - GITHUB_TOKEN=${GITHUB_TOKEN:-}
      # Offline mode (optional)
      - XAHEEN_OFFLINE_MODE=${XAHEEN_OFFLINE_MODE:-0}
      # Playwright
      - PLAYWRIGHT_BROWSER=${PLAYWRIGHT_BROWSER:-chromium}
      - PLAYWRIGHT_HEADLESS=true
      # Remote access (always enabled in Docker)
      - XAHEEN_ALLOW_REMOTE=1
    healthcheck:
      test: [ "CMD", "curl", "-f", "http://localhost:8888/api/health" ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

volumes:
  xaheen-projects:
    driver: local
  xaheen-db:
    driver: local
